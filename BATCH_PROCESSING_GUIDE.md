# æ‰¹é‡è§†é¢‘å¤„ç†æŒ‡å—

æœ¬æŒ‡å—è¯´æ˜å¦‚ä½•ä½¿ç”¨ `save_tracks.py` å’Œ `gen_draft_gt.py` è¿›è¡Œæ‰¹é‡è§†é¢‘å¤„ç†ã€‚

---

## ğŸ“‹ æ€»è§ˆ

| è„šæœ¬ | åŠŸèƒ½ | è¾“å…¥ | è¾“å‡ºæ ¼å¼ |
|------|------|------|--------|
| `save_tracks.py` | æå–è¿½è¸ªä¿¡æ¯ | è§†é¢‘ç›®å½• | MOT Challenge |
| `gen_draft_gt.py` | ç”Ÿæˆè‰ç¨¿æ ‡æ³¨ | è§†é¢‘æ–‡ä»¶/ç›®å½• | MOT Challenge |

---

## 1ï¸âƒ£ save_tracks.py - æ‰¹é‡è¿½è¸ªæå–

### åŠŸèƒ½
- è‡ªåŠ¨æŸ¥æ‰¾æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰ `.webm` å’Œ `.mp4` æ–‡ä»¶
- å¯¹æ¯ä¸ªè§†é¢‘ç‹¬ç«‹è°ƒç”¨ YOLO è¿½è¸ª
- **å…³é”®ç‰¹æ€§ï¼šæ¯ä¸ªè§†é¢‘çš„å¸§å·ä» 1 é‡æ–°å¼€å§‹**
- ç»“æœä¿å­˜åˆ° `data/result/` ç›®å½•ï¼Œæ–‡ä»¶åä¸è§†é¢‘åŒå

### åŸºæœ¬ä½¿ç”¨

```bash
# ä½¿ç”¨é»˜è®¤ç›®å½• (H:\GSEè®ºæ–‡èµ„æ–™\å®éªŒ\video_data)
python save_tracks.py

# æŒ‡å®šè‡ªå®šä¹‰è§†é¢‘ç›®å½•
python save_tracks.py --video "H:\GSEè®ºæ–‡èµ„æ–™\å®éªŒ\video_data"

# æŒ‡å®šè¾“å‡ºç›®å½•
python save_tracks.py --video "H:\video_data" --output "results/tracks"

# è°ƒæ•´ç½®ä¿¡åº¦é˜ˆå€¼ (ä½äº 0.1 ä¼šå¢åŠ æ¼æ£€ï¼Œä½†æ›´æ•æ„Ÿ)
python save_tracks.py --video "H:\video_data" --conf 0.15
```

### è¾“å‡ºç¤ºä¾‹

```
âœ… æˆåŠŸ: 3 ä¸ª
âŒ å¤±è´¥: 0 ä¸ª
ğŸ“ è¾“å‡ºç›®å½•: d:\Allen\...\data\result

ğŸ“„ ç”Ÿæˆçš„æ–‡ä»¶:
   âœ“ video_01.txt
   âœ“ video_02.txt
   âœ“ video_03.txt
```

### è¾“å‡ºæ–‡ä»¶æ ¼å¼ (MOT Challenge)

```
1,1,100.5,200.5,50.0,80.0,0.85,0,-1,-1
1,2,300.0,250.0,60.0,90.0,0.92,0,-1,-1
2,1,105.5,205.0,50.5,80.2,0.86,0,-1,-1
2,2,305.0,255.0,59.5,89.5,0.91,0,-1,-1
```

**åˆ—è¯´æ˜ï¼š**
- `frame_idx`: å¸§å· (ä» 1 å¼€å§‹)
- `track_id`: è¿½è¸ª ID
- `x1, y1`: å·¦ä¸Šè§’åæ ‡
- `w, h`: å®½åº¦å’Œé«˜åº¦
- `conf`: ç½®ä¿¡åº¦ [0, 1]
- `class_id`: ç±»åˆ« ID
- `-1, -1`: MOT æ ‡å‡†å ä½ç¬¦

---

## 2ï¸âƒ£ gen_draft_gt.py - ç”Ÿæˆè‰ç¨¿æ ‡æ³¨

### åŠŸèƒ½
- æ”¯æŒ **å•æ–‡ä»¶** å’Œ **ç›®å½•** ä¸¤ç§è¾“å…¥æ¨¡å¼
- è‡ªåŠ¨é€’å½’æœç´¢ç›®å½•ä¸‹çš„æ‰€æœ‰è§†é¢‘
- **æ™ºèƒ½è·³è¿‡**ï¼šå·²å­˜åœ¨çš„ `_gt.txt` é»˜è®¤è·³è¿‡ï¼Œé˜²æ­¢è¦†ç›–äººå·¥ä¿®æ­£
- æ”¯æŒ `--force` å¼ºåˆ¶è¦†ç›–
- è¾“å‡ºæ–‡ä»¶ä¿å­˜åœ¨è§†é¢‘åŒä¸€ç›®å½•

### åŸºæœ¬ä½¿ç”¨

#### æ¨¡å¼ A: å•ä¸ªè§†é¢‘å¤„ç†
```bash
# å¤„ç†å•ä¸ªè§†é¢‘
python gen_draft_gt.py --video video.webm

# å®Œæ•´è·¯å¾„
python gen_draft_gt.py --video "H:\GSEè®ºæ–‡èµ„æ–™\å®éªŒ\video_data\video_01.webm"

# è‡ªå®šä¹‰è¾“å‡ºè·¯å¾„
python gen_draft_gt.py --video video.webm --output "custom_output.txt"
```

#### æ¨¡å¼ B: æ‰¹é‡ç›®å½•å¤„ç† â­ (æ¨è)
```bash
# ä¸€é”®å¤„ç†æ•´ä¸ªç›®å½•çš„æ‰€æœ‰è§†é¢‘ï¼
python gen_draft_gt.py --video "H:\GSEè®ºæ–‡èµ„æ–™\å®éªŒ\video_data"

# è·³è¿‡å·²å­˜åœ¨çš„æ–‡ä»¶ (é»˜è®¤è¡Œä¸º)
python gen_draft_gt.py --video "H:\GSEè®ºæ–‡èµ„æ–™\å®éªŒ\video_data"

# å¼ºåˆ¶è¦†ç›–å·²å­˜åœ¨çš„ _gt.txt æ–‡ä»¶
python gen_draft_gt.py --video "H:\GSEè®ºæ–‡èµ„æ–™\å®éªŒ\video_data" --force

# è°ƒæ•´ç½®ä¿¡åº¦ (æ¨è 0.1 ä»¥å‡å°‘æ¼æ£€)
python gen_draft_gt.py --video "H:\GSEè®ºæ–‡èµ„æ–™\å®éªŒ\video_data" --conf 0.15
```

### è¾“å‡ºç¤ºä¾‹ (ç›®å½•æ¨¡å¼)

```
ğŸ¬ æ‰¾åˆ° 5 ä¸ªè§†é¢‘æ–‡ä»¶

[1/5] ğŸ“¹ video_01.webm
      ğŸ” å¼€å§‹æ¨ç†å’Œè¿½è¸ª (conf=0.1)...
      âœ… é¢„æ ‡æ³¨å®Œæˆï¼
      ğŸ“Š ç»Ÿè®¡ä¿¡æ¯:
         - å¤„ç†å¸§æ•°: 1500
         - æ£€æµ‹ç›®æ ‡æ•°: 3245
         - è¾“å‡ºæ–‡ä»¶: H:\...\video_01_gt.txt

[2/5] ğŸ“¹ video_02.webm
      â­ï¸  è·³è¿‡ (æ–‡ä»¶å·²å­˜åœ¨ï¼Œä½¿ç”¨ --force å¼ºåˆ¶è¦†ç›–)

[3/5] ğŸ“¹ video_03.webm
      ...

======================================================================
ğŸ“Š æ‰¹é‡å¤„ç†å®Œæˆï¼
   âœ… æˆåŠŸ: 4 ä¸ª
   â­ï¸  è·³è¿‡: 1 ä¸ª
   âŒ å¤±è´¥: 0 ä¸ª
   ğŸ“ è§†é¢‘ç›®å½•: H:\GSEè®ºæ–‡èµ„æ–™\å®éªŒ\video_data

ğŸ“„ ç”Ÿæˆçš„æ–‡ä»¶:
   âœ“ video_01_gt.txt
   âœ“ video_03_gt.txt
   âœ“ video_04_gt.txt
   âœ“ video_05_gt.txt
======================================================================
```

---

## ğŸ” å…³é”®æ£€æŸ¥ç‚¹

### âœ… Windows è·¯å¾„è½¬ä¹‰
ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸² (raw string) é˜²æ­¢ `\t` è¢«è½¬ä¹‰ä¸ºåˆ¶è¡¨ç¬¦ï¼š

```python
# âœ… æ­£ç¡®
r"H:\GSEè®ºæ–‡èµ„æ–™\å®éªŒ\video_data"

# âŒ é”™è¯¯ (\t ä¼šè¢«è½¬ä¹‰ä¸ºåˆ¶è¡¨ç¬¦)
"H:\GSEè®ºæ–‡èµ„æ–™\å®éªŒ\video_data"
```

### âœ… æ¨¡å‹æ–‡ä»¶æ£€æŸ¥
ç¡®ä¿æ¨¡å‹æ–‡ä»¶å­˜åœ¨äº `weights/` ç›®å½•ï¼š

```bash
# æ£€æŸ¥æ¨¡å‹æ–‡ä»¶
dir weights\gse_detection_v11.pt

# å¦‚æœä¸å­˜åœ¨ï¼Œä»å…¶ä»–é¡¹ç›®å¤åˆ¶
# æº: GSE_Detection_Portable\weights\gse_detection_v11.pt
# ç›®æ ‡: GSE_Detection_v11_Minimal\weights\gse_detection_v11.pt
```

### âœ… MOT æ ¼å¼éªŒè¯
ç”Ÿæˆå®Œæˆåï¼Œæ‰“å¼€ `.txt` æ–‡ä»¶éªŒè¯æ ¼å¼ï¼š

```txt
# âœ… æ­£ç¡®æ ¼å¼ (10 åˆ—ï¼Œé€—å·åˆ†éš”ï¼Œæµ®ç‚¹æ•° 2 ä½å°æ•°)
1,1,100.50,200.50,50.00,80.00,0.85,0,-1,-1
1,2,300.00,250.50,60.00,90.00,0.92,1,-1,-1
2,1,105.50,205.00,50.50,80.20,0.86,0,-1,-1

# âŒ é”™è¯¯æ ¼å¼ (å­—æ®µç¼ºå¤±æˆ–ç±»å‹é”™è¯¯)
1,1,100,200,50,80  # å­—æ®µä¸è¶³
```

---

## ğŸ“Š MOT Challenge æ ¼å¼è¯¦è§£

```
frame_idx,track_id,x1,y1,w,h,conf,class_id,-1,-1
```

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| frame_idx | int | å¸§å· (ä» 1 å¼€å§‹) | 1, 2, 3, ... |
| track_id | int | ç‰©ä½“è¿½è¸ª ID | 1, 2, 3, ... |
| x1 | float | å·¦ä¸Šè§’ x åæ ‡ | 100.50 |
| y1 | float | å·¦ä¸Šè§’ y åæ ‡ | 200.50 |
| w | float | å®½åº¦ (åƒç´ ) | 50.00 |
| h | float | é«˜åº¦ (åƒç´ ) | 80.00 |
| conf | float | ç½®ä¿¡åº¦ [0.0-1.0] | 0.85 |
| class_id | int | ç‰©ä½“ç±»åˆ« ID | 0-3 |
| -1 | int | ä¿ç•™å­—æ®µ | -1 |
| -1 | int | ä¿ç•™å­—æ®µ | -1 |

### åæ ‡è½¬æ¢è¯´æ˜

YOLO è¾“å‡ºçš„ `xywh` ä¸º**ä¸­å¿ƒåæ ‡**ï¼Œéœ€è½¬æ¢ä¸º**å·¦ä¸Šè§’åæ ‡**ï¼š

```python
# YOLO è¾“å‡º (ä¸­å¿ƒåæ ‡)
x_center, y_center, w, h = 125.5, 240.5, 50.0, 80.0

# è½¬æ¢ä¸ºå·¦ä¸Šè§’
x1 = x_center - w / 2  # 125.5 - 25.0 = 100.5
y1 = y_center - h / 2  # 240.5 - 40.0 = 200.5

# MOT è¾“å‡º (å·¦ä¸Šè§’)
x1 = 100.5, y1 = 200.5, w = 50.0, h = 80.0
```

---

## ğŸ¯ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•åªå¤„ç†æŸäº›è§†é¢‘ï¼Ÿ
```bash
# ä¸´æ—¶é‡å‘½åæˆ–ç§»åŠ¨ä¸éœ€è¦å¤„ç†çš„è§†é¢‘
# æˆ–ä½¿ç”¨é€šé…ç¬¦æ¨¡å¼
python gen_draft_gt.py --video "H:\video_data\01_*.webm"
```

### Q: å¤„ç†é€Ÿåº¦å¤ªæ…¢ï¼Ÿ
```bash
# é™ä½è§†é¢‘åˆ†è¾¨ç‡æˆ–å¸§ç‡å†å¯¼å…¥
# æˆ–ä½¿ç”¨ --conf é™ä½ç½®ä¿¡åº¦ä»¥å‡å°‘æ¨ç†æ—¶é—´
python gen_draft_gt.py --video path --conf 0.2
```

### Q: å¦‚ä½•æ¢å¤è¢«è¦†ç›–çš„æ–‡ä»¶ï¼Ÿ
```bash
# ä½¿ç”¨ git æ¢å¤ (å¦‚æœå·²æäº¤)
git checkout HEAD~1 -- path/to/file.txt

# æˆ–ä»å¤‡ä»½æ¢å¤
```

### Q: ç±»åˆ« ID çš„å«ä¹‰ï¼Ÿ
æŸ¥çœ‹ `config.py` ä¸­çš„ `CLASS_NAMES`ï¼š
```python
CLASS_NAMES = {
    0: 'Galley_Truck',
    1: 'GSE',
    2: 'Ground_Crew',
    3: 'airplane'
}
```

---

## ğŸš€ æœ€ä½³å®è·µ

1. **å…ˆå°è§„æ¨¡æµ‹è¯•**
   ```bash
   python gen_draft_gt.py --video "H:\test_video.webm"
   ```

2. **æ£€æŸ¥è¾“å‡ºæ ¼å¼**
   æ‰“å¼€ç”Ÿæˆçš„ `.txt` æ–‡ä»¶ï¼Œç¡®ä¿æ ¼å¼æ­£ç¡®

3. **æ‰¹é‡å¤„ç†å‰å¤‡ä»½**
   å¤‡ä»½ç°æœ‰çš„ `_gt.txt` æ–‡ä»¶

4. **ä½¿ç”¨ --force éœ€è°¨æ…**
   ç¡®ä¿æ²¡æœ‰é‡è¦çš„äººå·¥ä¿®æ­£åœ¨è¦†ç›–å‰

5. **ç›‘æ§é•¿å¤„ç†ä»»åŠ¡**
   å¤§ç›®å½•å¤„ç†æ—¶ï¼Œä¿ç•™ç»ˆç«¯çª—å£ä»¥æŸ¥çœ‹è¿›åº¦

---

## ğŸ“ å‘½ä»¤é€ŸæŸ¥è¡¨

```bash
# save_tracks.py
python save_tracks.py                           # é»˜è®¤ç›®å½•
python save_tracks.py --video "path"            # è‡ªå®šä¹‰ç›®å½•
python save_tracks.py --video "path" --conf 0.2 # è°ƒæ•´ç½®ä¿¡åº¦

# gen_draft_gt.py - å•æ–‡ä»¶
python gen_draft_gt.py --video "file.webm"                 # å•ä¸ªæ–‡ä»¶
python gen_draft_gt.py --video "file.webm" --output "gt.txt" # è‡ªå®šä¹‰è¾“å‡º

# gen_draft_gt.py - ç›®å½• (æ¨è)
python gen_draft_gt.py --video "path"                       # å¤„ç†ç›®å½•
python gen_draft_gt.py --video "path" --force               # å¼ºåˆ¶è¦†ç›–
python gen_draft_gt.py --video "path" --conf 0.15           # è°ƒæ•´ç½®ä¿¡åº¦
```

---

**æœ€åæ›´æ–°ï¼š2026-01-09**
